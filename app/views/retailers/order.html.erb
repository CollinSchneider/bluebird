<div class="row center-align">

  <div class="row">
    <div class="col s11 offset-s1 left-align">
      <a href="/products/<%=@product.id%>/<%=@product.slug%>" class='btn-flat black-text waves-effect'><h6>< Back to <%= @product.title%></h6></a>
    </div>
    <h4><%= @product.title %> Purchase Order</h4>
    <% if !@commit.nil? %>
      <h5>Ordered <%= @commit.amount %></h5>
    <% else %>
      <% if !@product.minimum_order.nil? %>
        <h6>Must order at least a minimum of <%= @product.minimum_order %> products</h6>
      <% end %>
    <% end %>
    <h6><%= flash[:notice] %></h6>
    <h6 class='green-text'><%= flash[:success] %></h6>
    <h6 class='red-text'><%= flash[:error] %></h6>
  </div>


  <form class="make-purchase-order" data-product="<%= @product.id %>">
    <div class="errors center-align"></div>
    <h5 class='green-text message'></h5>
    <div class="row border center-align">
      <div class="col s2 offset-s1">
        <h6 class='bold'>Product SKU</h5>
        </div>
        <div class="col s2">
          <h6 class='bold'>Full Wholesale Price</h6>
        </div>
        <div class="col s2">
          <h6 class='bold'>BlueBird Discounted Price</h6>
        </div>
        <div class="col s2">
          <h6 class='bold'>Suggested Retail Price</h6>
        </div>
        <div class="col s2">
          <h6 class='bold'>Order Amount (units)</h6>
        </div>
      </div>
    <% @product.skus.order(id: :asc).each do |sku| %>
      <div class="row" style='border-bottom: 1px solid black'>
        <% if sku.out_of_inventory? %>
          <h3 style='position: relative; background: rgba(140, 140, 140, 0.5); color: white; top: 35%; text-align: center; width: 100vw'>OUT OF INVENTORY</h3>
        <% end %>
        <div class="col s2 offset-s1">
          <h5><%= sku.description %></h5>
            <%= image_tag sku.image.url(:thumb), :class => 'responsive-img' %>
          <h6><%= sku.inventory %> in inventory</h6>
        </div>
        <div class="col s2">
          <h6 class='bold'><%= number_to_currency(sku.price) %></h6>
        </div>
        <div class="col s2">
          <h6 class='bold'><%= number_to_currency(sku.price_with_fee) %></h6>
          <h6><%= number_to_currency(sku.price - sku.price_with_fee) %> off</h6>
        </div>
        <div class="col s2">
          <h6 class='bold'><%= number_to_currency(sku.suggested_retail) %></h6>
        </div>
        <div class="col s2">
          <% if sku.user_ordered?(current_user) || !sku.out_of_inventory? %>
            <% order = current_user.retailer.purchase_orders.where('sku_id = ?', sku.id) %>
            <input type="number" class='full-box-input purchase-order-amount' data-sku="<%= sku.id %>" placeholder="Order Amt" min="0" value="<%= order.empty? ? nil : order.first.quantity %>">
            <% if !order.empty? %>
              <a href='/api/orders/delete_purchase_order?order=<%= order.first.id %>'><h6 class='black-text pointer'>X Remove Order</h6></a>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
    <div class="right-align">
      <% submit_val = current_user.retailer.products_orders(@product.id) ? "Update Order" : "Make Purchase Order" %>
      <input type="submit" value="<%= submit_val %>" class='btn submit'>
    </div>
    <div class="left-align">
      <% if !@commit.nil? %>
        <a class='btn-flat white black-text waves-effect' href="/api/orders/delete_commit?commit=<%=@commit.uuid %>">Cancel Entire Order</a>
      <% end %>
    </div>
  </form>

</div>
